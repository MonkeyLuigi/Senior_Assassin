<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Senior Assassin - Host</title>
    <script src="https://cdn.skypack.dev/@octokit/core"></script> <!-- Octokit library -->
</head>
<body>
    <h1>Senior Assassin - Host</h1>
    <div>
        <button onclick="startNewGame()">Start New Game</button>
        <p id="game-code-display">Game Code: </p>
    </div>

    <script>
        // Replace this with your GitHub Personal Access Token
        const GITHUB_TOKEN_PREFIX = 'github_pat_';
        const GITHUB_TOKEN_SUFFIX = '11BNBPGZA0Evss9oJ0Kq26_OwZFBh8l8vBy5VOwckmG5olL5GoA7G9KjIFIQYiHI3RKMOSMNT3Wy2Py21k';
        const GITHUB_TOKEN = GITHUB_TOKEN_PREFIX + GITHUB_TOKEN_SUFFIX;
        const GITHUB_API_OWNER = 'monkeyluigi'; // Replace with your GitHub username
        const GITHUB_API_REPO = 'senior_assassin'; // Replace with your repository name

        const octokit = new Octokit({
            auth: GITHUB_TOKEN
        });

        async function startNewGame() {
            const gameCode = Math.floor(Math.random() * 1000000).toString();
            const filePath = `${gameCode}.json`; // Each game gets its own file
            const initialData = {
                gameCode: gameCode,
                players: []
            };

            try {
                // Attempt to create a new game file on GitHub
                const response = await octokit.request('PUT /repos/{owner}/{repo}/contents/{path}', {
                    owner: GITHUB_API_OWNER,
                    repo: GITHUB_API_REPO,
                    path: filePath,
                    message: `Create a new game with code ${gameCode}`,
                    committer: {
                        name: 'Game Host',
                        email: 'host@example.com'
                    },
                    content: btoa(JSON.stringify(initialData)),
                    headers: {
                        'X-GitHub-Api-Version': '2022-11-28'
                    }
                });

                if (response.status === 201) { // Status 201 indicates successful file creation
                    document.getElementById('game-code-display').textContent = `Game Code: ${gameCode}`;
                    alert("Game started! Share this code with joiners.");
                } else {
                    alert("Failed to create game. Please check your GitHub settings.");
                }
            } catch (error) {
                console.error('Error:', error);
                alert("An error occurred while creating the game.");
            }
        }
    </script>
</body>
</html>
